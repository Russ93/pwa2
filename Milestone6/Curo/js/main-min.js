$(function(){function t(){v.empty(),$.get("templates/landing.html",function(e){$.template("landing",$(e).find("#template_landing").html()),v.append($.render("","landing"));var t=$("#space").html();$("#jlog").click(function(){$("#space").html()==t&&($.template("login",$(e).find("#template_login").html()),$("#space").append($.render("","login")),$("#submit_login").on("click",function(e){e.preventDefault(),p()})),g(t)});var i=$("#regis").html();$("#rEmail").click(function(){$("#regis").html()==i&&($.template("registration",$(e).find("#template_regis").html()),$("#regis").append($.render("","registration")),$("#rSubmit").ready(function(){$("#rSubmit").on("click",function(e){e.preventDefault(),m()})}))})})}function i(){v.empty(),$.get("templates/app.html",function(e){$.template("app",$(e).find("#template_landing").html()),v.append($.render("","app")),$.template("appHeader",$(e).find("#template_app").html()),v.append($.render("","appHeader"));var s=$("#space").html();return $("#new").on("click",function(){$("#space").html()==s&&($.template("new_obj",$(e).find("#template_new").html()),$("#space").append($.render("","new_obj"))),g(s),$("#add").on("click",function(e){e.preventDefault(),d(),i()})}),$("#lout").on("click",function(e){e.preventDefault(),$.get("xhr/logout.php",function(){t()})}),$("#logo").css("cursor","pointer"),$("#logo").on("click",function(){i()}),$("#usr").css("cursor","pointer"),$("#usr").on("click",function(){$.template("drop_name",$(e).find("#template_account_info").html()),$("#drop").html($.render("","drop_name")),$("#editAccount").css("cursor","pointer"),$("#editAccount").on("click",function(){$("#drop").empty(),$("#space").html()==s&&($.template("edit_acc",$(e).find("#template_new").html()),$("#space").append($.render("","edit_acc")),$(".popHead").html("Edit Your Account"),$(".forName").html("New Email Address"),$("#name").val($("#usr").attr("usrEmail")),$("#desc,#urg,.forDesc,.forType").remove(),$.template("acc_input",$(e).find("#template_edit_account").html()),$($.render("","acc_input")).insertAfter("#name")),g(s),$("#add").on("click",function(e){e.preventDefault(),u()})}),$("#off").on("click",function(){$("#drop").empty()})}),o(),!1}),a()}function s(){$.ajax({url:"xhr/check_login.php",type:"get",dataType:"json",success:function(e){e.user?i():t()}})}function a(){$.ajax({url:"xhr/get_user.php",type:"get",dataType:"json",success:function(e){var t=e.user.user_n;$.get("templates/app.html",function(t){var i=$(t).find("#template_projects").html();$.template("projectView",i);var s=$.render(e.projects,"projectView");$("#projectSpace").append(s)}),$("#title").html(t)}})}function o(){$.ajax({url:"xhr/get_projects.php",type:"get",dataType:"json",success:function(e){$.get("templates/app.html",function(t){var s=$(t).find("#template_projects").html();$.template("projectView",s);var a=$.render(e.projects,"projectView");$("#projectSpace").append(a);var o=$("#space").html();$(".info").on("click",function(e){var t=$(this).children("h2"),i=$(t).html();e.preventDefault(),r($(this).prev().attr("projectID"),i)}),$(".edit").on("click",function(e){e.preventDefault();var s=$(this).attr("projectID");$("#space").html()==o&&($.template("new_obj",$(t).find("#template_new").html()),$("#space").append($.render("","new_obj")),$(".popHead").html("Edit Project"),$("#name").val($($(this).next().children("h2")).html()),$("#desc").val($($(this).next().children("p")).html()),$(".pros").prepend('<span id="delete">Delete Project</span>'),$("#delete").on("click",function(e){e.preventDefault,n("pro",s)})),g(o),$("#add").on("click",function(e){e.preventDefault(),h(s),i()})})})}})}function n(e,t){"pro"===e?$.ajax({url:"xhr/delete_project.php",data:{projectID:t},type:"post",dataType:"json",success:function(){i()}}):"task"===e?$.ajax({url:"xhr/delete_task.php",data:{taskID:t},type:"post",dataType:"json",success:function(){$("#space").html("")}}):console.log("you forgot something")}function r(e,t){$(".label").html(t),$("#new").html("New Task"),$("#new").unbind(),$.ajax({url:"xhr/get_tasks.php",type:"get",data:{projectID:e},dataType:"json",success:function(t){$.get("templates/app.html",function(i){$("#projectSpace").empty();var s=$(i).find("#template_task_view").html();$.template("taskView",s);var a=$.render(t.tasks,"taskView");$("#projectSpace").append(a);var o=$("#space").html();$("#new").on("click",function(){$("#space").html()==o&&($.template("new_obj",$(i).find("#template_new").html()),$("#space").append($.render("","new_obj")),$(".popHead").html("Create a New Task"),$(".forName").html("Task Name:"),$("#desc").after('<label>Due Date:</label><input id="due" type="text" value="due" name="due"/>')),g(o),$("#add").on("click",function(t){t.preventDefault(),l(e)})}),$(".edit").on("click",function(t){t.preventDefault();var s=$(this).attr("taskID");$(this).attr("#name"),$("#space").html()==o&&($.template("new_obj",$(i).find("#template_new").html()),$("#space").append($.render("","new_obj")),$(".popHead").html("Edit Task"),$(".pros").prepend('<span id="delete">Delete Task</span>'),$(".forName").html("Task Name:"),$("#desc").after('<label>Due Date:</label><input id="due" type="text" value="due" name="due"/>'),$("#name").val($($(this).next().children("h2")).html()),$("#desc").val($($(this).next().children("p")).html()),$("#due").val($($(this).siblings("p")).html()),$("#delete").on("click",function(t){t.preventDefault,n("task",s),r(e)})),g(o),$("#add").on("click",function(t){t.preventDefault(),c(s),r(e)})})})}})}function l(e){var t=$("#name").val(),i=$("#due").val(),s=$("#desc").val(),a=$("#urg").val();$.ajax({url:"xhr/new_task.php",data:{projectID:e,taskName:t,status:a,taskDescription:s,dueDate:i},type:"post",dataType:"json",success:function(t){t.error?console.log(t.error):(data="",$("#space").html(data),r(e))}})}function c(e){var t=$("#name").val(),i=$("#due").val(),s=$("#desc").val(),a=$("#urg").val();$.ajax({url:"xhr/update_task.php",data:{taskID:e,taskName:t,status:a,taskDescription:s,dueDate:i},type:"post",dataType:"json",success:function(e){e.error?console.log(e.error):(data="",$("#space").html(data))}})}function d(){var e=$("#name").val(),t=$("#desc").val(),i=$("#urg").val();$.ajax({url:"xhr/new_project.php",data:{projectName:e,status:i,projectDescription:t},type:"post",dataType:"json",success:function(e){e.error?console.log(e.error):(data="",$("#space").html(data))}})}function h(e){var t=$("#name").val(),i=$("#desc").val(),s=$("#urg").val();$.ajax({url:"xhr/update_project.php",data:{projectID:e,projectName:t,status:s,projectDescription:i},type:"post",dataType:"json",success:function(e){e.error?console.log(e.error):(data="",$("#space").html(data))}})}function u(){var e=$("#name").val(),t=$("#pass").val(),s=$("#f_nam").val(),a=$("#l_nam").val(),o=$("#phone").val();$.ajax({url:"xhr/update_user.php",data:{email:e,user_p:t,first_name:s,last_name:a,phone:o},type:"post",dataType:"json",success:function(e){e.error?(console.log(e.error),$("#ack").html("* "+e.error)):i()}})}function p(){var e=$("#username").val(),t=$("#password").val();$.ajax({url:"xhr/login.php",data:{username:e,password:t},type:"post",dataType:"json",success:function(e){e.error?(console.log(e.error),$("#ack").html("* "+e.error)):i()}})}function m(){var t=$("#rEmail").val(),s=$("#rUser").val(),a=$("#rPass").val();$.ajax({url:"xhr/register.php",data:{email:t,username:s,password:a},type:"post",dataType:"json",success:function(t){t.error?console.log(t.error):(i(),e.preventDefault())}})}function f(){s()}function g(e){$("#close").click(function(){$("#space").html(e)})}var v=$("#container");f()});